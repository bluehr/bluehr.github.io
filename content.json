{"pages":[{"title":"about","text":"test about","link":"/about/index.html"}],"posts":[{"title":"OpenWrt安装Adguard home且显示客户端IP","text":"前情提要​ 某天在V站上看到一篇贴子 我家电视机正在监视所有连网设备，其内容大致就是某国产电视每隔 10 分钟扫一遍全家连网的设备，把 hostname 、mac 、ip 甚至网络延迟时间全传回去了，还探测周围的 wifi SSID 名称、mac 地址也打包传到这个 gz-data .com 的域名。 ​ 我知道国产厂商没有底线，没有想到是这么的没有底线 ​ 在21/04/27该电视厂商发了一个声明与勾正解除合作关系的声明 AdGuard Home​ 它是一个广告拦截与反跟踪软件，本质上也是一个DNS服务器，其原理就是在DNS解析的环节把一些域名的解析给Block了。 OpenWrt安装AdGuard Home，配合SSR PLUS+​ 我用的是esir v4.1精简包固件，在服务中点击Adguard Home，勾选启用，更新核心版本。 ​ 如果更新核心一直失败，可以将科学上网工具暂时修改为全局代理。 然后点击保存应用，可以打开routerIp:3000来配置adguard home，网页监听端口随意，DNS服务器端口也随意。 上游DNS： 119.29.29.29 (随意) Bootstrap DNS ：119.6.6.6 （这里最好配置为你的ISP 给的默认DNS） 配置过滤器-&gt;DNS封锁清单：https://anti-ad.net/easylist.txt 再将路由器的adguard home 重定向设置为 “作为dnsmasq的上游服务器” 保存应用。 设置SSR PLUS+ ​ 测试是否生效​ 访问hm.baidu.com， ​ ​ Adguard Home dashboard ​ 此时广告拦截和科学上网都是可用的，不过还是有个小问题，在Adguard Home dashboard中 客户端ip无论如何都是127.0.0.1。 解决客户端只有127.0.0.1​ 参考：luci-app-adguardhome 中关于 SSR 配合使用 方法一gfw代理：dns重定向-作为dnsmasq的上游服务器 方法二gfw代理：手动设置adh上游dns为自己即127.0.0.1:[自己监听的端口]，然后使用 dns重定向-使用53端口替换dnsmasq，（因为端口互换后就是dnsmasq为上游了） 方法三国外ip代理：任意重定向方式，adh加入gfw列表，开启计划任务定时更新gfw即可 方法四gfw代理：dns重定向-重定向53端口到AdGuardHome,设置adh上游dns 为127.0.0.1:53 我使用方法二，配置如下： 修改adh 上游dns 为127.0.0.1:54 ​ 修改adh 重定向：使用53端口替换dnsmasq 最终会发现原本DHCP/DNS高级设置中的DNS 服务器端口变为了54，而adh监听的端口变成了53，这应该就是luci-app-adguardhome作者提到的端口互换吧。 ​ ​ ​ 除了上述方案，我还曾参考AdGuard Home从入门到弃坑中的1.4来试验，或许是固件差异，我并没能成功。不过其中的步骤非常详细，值得一看。","link":"/2021/04/28/OpenWrt%E5%AE%89%E8%A3%85Adguard-home%E4%B8%94%E6%98%BE%E7%A4%BA%E5%AE%A2%E6%88%B7%E7%AB%AFIP/"}],"tags":[{"name":"路由器","slug":"路由器","link":"/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/"},{"name":"折腾备忘录","slug":"折腾备忘录","link":"/tags/%E6%8A%98%E8%85%BE%E5%A4%87%E5%BF%98%E5%BD%95/"},{"name":"OpenWrt","slug":"OpenWrt","link":"/tags/OpenWrt/"}],"categories":[]}