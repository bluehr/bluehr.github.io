{"pages":[{"title":"about","text":"test about","link":"/about/index.html"}],"posts":[{"title":"Intel X540 网卡固件升级","text":"前言最近新购了一张Silicom X540-T2 万兆网卡，在PVE系统中尝试打开SRIOV时，发现这张网卡不支持SRIOV，搜索一番后以为是固件太老导致的（实际上升级后还是不支持）。 准备工作从Intel官网下载固件， 下载地址：固件下载准备一个操作系统 Windows or DOS，为了方便后文都是用的是Windows 安装升级程序运行下载的PREBOOT.exe 选择任意路径将BootIMG.FLB拷贝到BOOTUTILW64E同目录下，方便后续升级 升级使用管理员身份运行CMD 输入 BOOTUTILW64E.EXE -IMAGEVERSION 12345678910111213141516171819202122232425262728293031C:\\tools\\Intel25\\APPS\\BootUtil\\Winx64&gt;BOOTUTILW64E.EXE -IMAGEVERSIONIntel(R) Ethernet Flash Firmware UtilityBootUtil version 1.7.10.10Copyright (C) 2003-2019 Intel CorporationImage versions in BootIMG.FLB Combo Image Version Name 1.2585.0 Combo Rules v4.85.00 Clp-Loader Option ROM v3.1.16 40G Interface Module v1.0.79 iSCSI Option ROM v3.1.58 iSCSI Setup Option ROM v3.1.58 Intel(R) Boot Agent GE v1.5.88 Intel(R) Boot Agent XE v2.4.34 Intel(R) Boot Agent XE (X550) v2.4.34 Intel(R) Boot Agent I40E v1.1.10 Intel(R) Boot Agent CL v0.1.16 UEFI x64 PCI-E gigabit driver v9.1.12 UEFI x64 10 gigabit driver v7.5.12 UEFI x64 40 gigabit driver v4.0.15 OCD Option ROM v0.9.04Port Network Address Location Series WOL Flash Firmware Version==== =============== ======== ======= === ============================= ======= 1 00E0ED5D2CC6 1:00.0 10GbE N/A UEFI,PXE Enabled 2.3.17 2 00E0ED5D2CC7 1:00.1 10GbE N/A UEFI,PXE Enabled 2.3.17C:\\tools\\Intel25\\APPS\\BootUtil\\Winx64&gt; 备份原来的固件 BOOTUTILW64E.EXE -Nic=1 -SAVEIMAGE -file xxx.flb 123456789101112C:\\tools\\Intel25\\APPS\\BootUtil\\Winx64&gt;BOOTUTILW64E.EXE -Nic=1 -SAVEIMAGE -file backup_540.flbIntel(R) Ethernet Flash Firmware UtilityBootUtil version 1.7.10.10Copyright (C) 2003-2019 Intel CorporationSaving flash firmware image on port 1 to file backup_540.flb...savedPort Network Address Location Series WOL Flash Firmware Version==== =============== ======== ======= === ============================= ======= 1 00E0ED5D2CC6 1:00.0 10GbE N/A UEFI,PXE Enabled 2.3.17 2 00E0ED5D2CC7 1:00.1 10GbE N/A UEFI,PXE Enabled 2.3.17 升级 BOOTUTILW64E.EXE -UP=PXE -ALL ( 默认使用同目录下的 BootIMG.FLB 固件进行升级 )，升级过程中可能会需要输入1-2次Y确认 123456789101112131415161718192021222324C:\\tools\\Intel25\\APPS\\BootUtil\\Winx64&gt;BOOTUTILW64E.EXE -UP=PXE -ALLIntel(R) Ethernet Flash Firmware UtilityBootUtil version 1.7.10.10Copyright (C) 2003-2019 Intel CorporationProgramming flash on port 1 with flash firmware imageCreate restore image of NIC 1 before proceeding? (Y)es or (N)o: YSaving flash firmware image on port 1 to file 1528400B.FLB...savedUpdating PXE removes PXE+EFI functionality.Would you like to continue? (Y)es or (N)o: Y/Flash update successfulSkipping port 2 (shared flash with previous port)Port Network Address Location Series WOL Flash Firmware Version==== =============== ======== ======= === ============================= ======= 1 00E0ED5D2CC6 1:00.0 10GbE N/A PXE 2.4.34 2 00E0ED5D2CC7 1:00.1 10GbE N/A PXE 2.4.34C:\\tools\\Intel25\\APPS\\BootUtil\\Winx64&gt; 最后升级完成，重启进入PVE后看网卡固件已经更新了，使用命令行查看这张网卡还是不支持SRIOV， 很奇怪；换了张浪潮的X540-T2就支持SRIOV了，如果有大佬知道怎么在Silicom这张网卡上开启SRIOV麻烦指导下我。","link":"/2023/07/05/Intel%20X540%20%E7%BD%91%E5%8D%A1%E5%9B%BA%E4%BB%B6%E5%8D%87%E7%BA%A7/"},{"title":"OpenWrt安装Adguard home且显示客户端IP","text":"前情提要​ 某天在V站上看到一篇贴子 我家电视机正在监视所有连网设备，其内容大致就是某国产电视每隔 10 分钟扫一遍全家连网的设备，把 hostname 、mac 、ip 甚至网络延迟时间全传回去了，还探测周围的 wifi SSID 名称、mac 地址也打包传到这个 gz-data .com 的域名。 ​ 我知道国产厂商没有底线，没有想到是这么的没有底线 ​ 在21/04/27该电视厂商发了一个声明与勾正解除合作关系的声明 AdGuard Home​ 它是一个广告拦截与反跟踪软件，本质上也是一个DNS服务器，其原理就是在DNS解析的环节把一些域名的解析给Block了。 OpenWrt安装AdGuard Home，配合SSR PLUS+​ 我用的是esir v4.1精简包固件，在服务中点击Adguard Home，勾选启用，更新核心版本。 ​ 如果更新核心一直失败，可以将科学上网工具暂时修改为全局代理。 然后点击保存应用，可以打开routerIp:3000来配置adguard home，网页监听端口随意，DNS服务器端口也随意。 上游DNS： 119.29.29.29 (随意) Bootstrap DNS ：119.6.6.6 （这里最好配置为你的ISP 给的默认DNS） 配置过滤器-&gt;DNS封锁清单：https://anti-ad.net/easylist.txt 再将路由器的adguard home 重定向设置为 “作为dnsmasq的上游服务器” 保存应用。 设置SSR PLUS+ ​ 测试是否生效​ 访问hm.baidu.com， ​ ​ Adguard Home dashboard ​ 此时广告拦截和科学上网都是可用的，不过还是有个小问题，在Adguard Home dashboard中 客户端ip无论如何都是127.0.0.1。 解决客户端只有127.0.0.1​ 参考：luci-app-adguardhome 中关于 SSR 配合使用 方法一gfw代理：dns重定向-作为dnsmasq的上游服务器 方法二gfw代理：手动设置adh上游dns为自己即127.0.0.1:[自己监听的端口]，然后使用 dns重定向-使用53端口替换dnsmasq，（因为端口互换后就是dnsmasq为上游了） 方法三国外ip代理：任意重定向方式，adh加入gfw列表，开启计划任务定时更新gfw即可 方法四gfw代理：dns重定向-重定向53端口到AdGuardHome,设置adh上游dns 为127.0.0.1:53 我使用方法二，配置如下： 修改adh 上游dns 为127.0.0.1:54 ​ 修改adh 重定向：使用53端口替换dnsmasq 最终会发现原本DHCP/DNS高级设置中的DNS 服务器端口变为了54，而adh监听的端口变成了53，这应该就是luci-app-adguardhome作者提到的端口互换吧。 ​ ​ ​ 除了上述方案，我还曾参考AdGuard Home从入门到弃坑中的1.4来试验，或许是固件差异，我并没能成功。不过其中的步骤非常详细，值得一看。","link":"/2021/04/28/OpenWrt%E5%AE%89%E8%A3%85Adguard-home%E4%B8%94%E6%98%BE%E7%A4%BA%E5%AE%A2%E6%88%B7%E7%AB%AFIP/"},{"title":"ikuai多拨-成都联通多拨教程","text":"ikuai多拨多拨配置很简单，到“外网设置”把“接入方式修改为基于物理网卡的混合模式”，然后到ADSL/PPPOE拨号中添加你的账号，添加多个即可。 这里我没有跟别人一样使用多拨助手，是因为我用多拨助手无论如何都只有1拨，应该跟我是成都联通有关，而且成都联通要多拨成功需要把这里的账号同时启用才有一定概率能同时拨上。 负载均衡叠加宽带我这里测试使用新建连接数这个模式能较好的叠加宽带。 叠加前后对比 多公网IP如何设置端口转发如果你不想每次修改多拨配置（比如从多拨转换成非多拨）后都要来手动调整一下端口映射，那你可以把这个外网地址调整为全部线路。 可能你在UI上来选择全部线路保存后，它还是变成了各个具体的线路。 可以通过修改导出的配置文件来实现： 把interface配置改成interface=all 再导入就实现了。 12id=1 enabled=yes comment=mongo%20docker interface=all lan_addr=192.168.2.110 protocol=tcp wan_port=27017 lan_port=27017","link":"/2021/07/01/iKuai%E5%A4%9A%E6%8B%A8-%E6%88%90%E9%83%BD%E8%81%94%E9%80%9A%E5%A4%9A%E6%8B%A8%E6%95%99%E7%A8%8B/"},{"title":"捡垃圾之4U服务器","text":"折腾前提我之前折腾的蜗牛星际（换了b365 + i3 9100 + 16G）越来越难以满足我的需求，没办法随心所欲的分配内存/CPU给虚机，就又开始物色合适的机器。这次我再也不想折腾ITX机型了，拓展性和散热简直折磨人，而且自打我从杭州的15平小房间搬到成都2居室后，再也不担心放不放得下的问题了！ 刚开始相中了Dell的塔式服务器T630，找了很大一圈都是4000-5000左右价位的准系统，很离谱，我记得B站Up主无情开评2K+入手的，果断放弃。 又在V站看到了有人配浪潮SA5212M4 2U服务器，真的很便宜，准系统就800块，简直香得一匹，但是考虑到2U没有接触过，噪音问题不好把控，先放置一边。 闲逛的时候看到有人推荐了拓普龙S465-24这类24盘位4U机箱，很满意，拓展性拉满。但是全新机箱1700+ 有点劝退，本垃圾佬秉承着勤俭持家的原则，当然是去海鲜市场逛逛，最终发现了一套价值大概在3500左右但是只卖2600的整机，马上拿下。配置单如下表 类别 型号 二手行情价 机箱 拓普龙S465-24 600-800 主板 超微X10DRL-LN4 1400 CPU 2680 V4 500 内存 32G海力士 REG ECC X2 1000 硬盘 128G 三星 + 佳翼SK15转接卡 130 阵列卡 LSI 9211-8i 100 电源 长城CRPS550 550W x2 热拔插冗余电源 150 到货开箱​ 机箱：4U的机箱确实有点大，看着这24盘位就很满足！哈哈，再跟我的蜗牛C对比。 主板 电源 阵列卡 插电开机开机的时候才想起来，这类服务器主板基本都是只有VGA接口，家里已经没有VGA的显示器了-_-不过还好有IPMI可以远程管理，到爱快里找到IPMI的IP, 登录结果完犊子，用默认密码进不去！！我以为是密码被之前的用户修改了，马上找了官方指导手册，短接JBT1重置BIOS（这个JBT1有意思，不是常规的两根针脚，而是两个焊点） 重置完后发现密码还是不对，后来在主板标签上找到了密码，这是什么操作，超微家的设计都这么秀吗 用标签上的密码终于进去了，IMPI可以远程装系统，改BIOS设置，真的很方便。 目前来说开机声音确实起飞，后面再讲静音化改造。 背板刷直通模式参考别人的教程直接刷就行了 测试CPU AIDA64 烤机2小时温度也没过60C°（我把机箱风扇都拔了，太吵了），内存测试也没问题，就是卖家原来插的硬盘转接卡插到了PCIE2.0*4的槽位上了这个板子就是PCI-E插槽太少了，不过对于我这种从ITX机箱换过来的用户还是有一种很富余的假象。 硬盘背板测试24个硬盘位的时候就遇到大问题了首先我这个LSI 9211阵列卡的2个SAS口只能连接8个硬盘主板上还有2个SAS口连接8个硬盘最大一次性只能识别16个位置，所以在测试期间，我需要把连接背板的口子换一下才能全部测试。 这个24盘位硬盘背板的，其本质也是2个一模一样的12盘位背板组合而成 测试中发现上面一些个硬盘位能识别出来，但是指示灯始终是红色，我刚开始以为是背板的问题，于是乎把背板干下来，下方的硬盘背板多链接4根不同的线，有主板USB，机箱跳线，还有两根屏幕排线一样的东西。我就把背板调换了一下，发现还是一样的问题。 后来才意识到应该是主板的SAS接口连接的硬盘都会有这个现象，跟背板本身并没有关系，截止目前我也仍然不清楚为啥主板的SAS接口会有这个问题，感觉这个主板也没有集成了SAS阵列卡功能，只能后续再看看有没有办法了（希望有大佬能教教我是不是我BIOS设置有问题） 。01/26 后续更新：原来是主板那两根SAS线有问题，换了线就好了😅,为了排除是我设置或者连线的问题,我还去骚扰了下机箱厂商客服,哈哈 机箱机箱右边还有一个UID接口怎么都不亮，看了下是跳线没有连接，但是主板的跳线是单针的，机箱又是2针的不知道怎么搞了。 听说超微的技术支持都很给力，马上邮件问问，得到的答复是不支持第三方机箱。。心塞 静音改造机箱上自带的热拔插风扇结构很简单，就是一个12038风扇加一个壳子，把风扇的4Pin接口（下图中红色框中的）卡在壳子上面， 我找了下自己的库存发现了一个Arctic F12风扇，但是这个扇子的4Pin接口（下图中黑色的接口)没有办法卡住， 淘宝找了一圈，也没发现这种接口的风扇，只能作罢，将就吧，打不了不用热拔插呗，还是静音比较重要。 总结第一次接触到服务器主板，发现服务器主板带有的IPMI确实很好用，很强大，效果如下 传感器监控： 冗余电源监控，还能看到电压电流温度，补充一下这个电源还挺静音的。 还能直接远程控制操作系统 录屏，跟采集卡的效果差不多 目前除了主板的硬盘接口有点小问题没解决外，这次捡漏应该算是成功的，先装个ESXI，日后慢慢加满硬盘。","link":"/2022/01/20/%E6%8D%A1%E5%9E%83%E5%9C%BE%E4%B9%8B4U%E6%9C%8D%E5%8A%A1%E5%99%A8/"}],"tags":[{"name":"硬件","slug":"硬件","link":"/tags/%E7%A1%AC%E4%BB%B6/"},{"name":"服务器","slug":"服务器","link":"/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/"},{"name":"网络","slug":"网络","link":"/tags/%E7%BD%91%E7%BB%9C/"},{"name":"路由器","slug":"路由器","link":"/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/"},{"name":"折腾备忘录","slug":"折腾备忘录","link":"/tags/%E6%8A%98%E8%85%BE%E5%A4%87%E5%BF%98%E5%BD%95/"},{"name":"OpenWrt","slug":"OpenWrt","link":"/tags/OpenWrt/"},{"name":"iKuai","slug":"iKuai","link":"/tags/iKuai/"},{"name":"X86","slug":"X86","link":"/tags/X86/"}],"categories":[]}